<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><title>用户区域管理</title><link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link href="../css/my.css" rel="stylesheet"><link href="//at.alicdn.com/t/font_newtymnvzenuerk9.css" rel="stylesheet"><link href="../css/component.css" rel="stylesheet"><link rel="stylesheet" href="../css/index.css"><style>.companyinfo{font-size:11px;color:#bbb}.list-group-item:active{color:#ccc}.area-cursor{cursor:pointer}.greenColor{background-color:green}</style></head><body><div id="CompanyPerList"><nav class="navbar navbar-fixed-top"><div class="person-info text-center"><a href="my.html" class="iconfont icon-fanhui btn-back"></a> 设置人员所属区域</div></nav><div><ul class="list-group" v-show="!noPerson"><li class="list-group-item" style="border:none;border-bottom:1px solid #ddd" v-for="item in items" v-on:click="itemClick(item)"><div>昵称:{{item.NickName||'暂无'}}</div><div><span class="text-left companyinfo">手机号码:{{item.Phone||'暂无'}}</span><span class="text-right companyinfo">性别:{{item.Sex||'暂无'}}</span></div><div class="text-left companyinfo">邮箱:{{item.Email||'暂无'}}</div><div class="text-left companyinfo">所属区域:<span></span>{{item.AreaName||'暂无'}}</div></li></ul><ul class="list-group" v-show="noPerson"><li class="list-group-item" style="border:none;border-bottom:1px solid #ddd"><div class="text-center companyinfo">暂时还没有人员</div></li></ul></div><div class="area" id="area-show-panel" v-show="areaShow"><span class="search-tag area-cursor" v-bind:class="{ greenColor:!!area.isSelect }" data-type="area" data-id="{{area.id}}" v-for="area in areas" v-on:click="getSelectItem(area)">{{area.name}}</span></div></div><script src="../js/jquery-3.1.0.js"></script><script src="../common/httpParams.js"></script><script src="../common/layer/layer.js"></script><script src="../common/LayerFunction.js"></script><script src="../common/vue.js"></script><script>var Mag=new Vue({el:"#CompanyPerList",data:{items:[],areaShow:!1,areas:[],noPerson:!1},methods:{getSelectItem:function(e){e.isSelect=!e.isSelect},itemClick:function(e){this.areaShow=!0;var a=this.areas.filter(function(e){return e.isSelect=!1,!0});if(e.AreaName){var t=e.AreaId.split(",");if(t.length>0)for(var n=0;n<t.length-1;n++)a[t[n]-1].isSelect=!0}layer.open({title:"区域列表",type:1,closeBtn:!1,content:$("#area-show-panel"),btn:["提交","取消"],btnAlign:"c",success:function(e){e.find(".layui-layer-btn").css("text-align","center")},yes:function(t,n){var r="";a.forEach(function(e){e.isSelect&&(r+=e.id+",")}),r?$.post("/api/company/setcompanypersonarea",{userId:e.UserId+"",areas:r},function(e){e.error?layer.alert(e.error,{icon:0}):layer.msg("用户区域添加成功",{icon:1,time:1e3},function(){CloseLoad(t),location.reload()})}):layer.alert("请选择区域",{icon:2})},cancel:function(e){}})}},created:function(){var e=this;$.get("/api/device/initdata",function(a){e.areas=a.area.filter(function(e){return e.isSelect=!1,!0}),$.get("/api/company/getcompanypersonlist",{appType:localStorage.appType},function(a){a.length>0?e.items=a.filter(function(a){if(a.AreaName){var t=a.AreaName.split(",");if(t.length>0){a.AreaId=a.AreaName,a.AreaName="";for(var n=0;n<t.length-1;n++)a.AreaName+=e.areas[t[n]-1].name+","}}return!0}):e.noPerson=!0})})}})</script></body></html>