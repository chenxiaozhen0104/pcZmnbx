@{
    ViewBag.Title = "欢迎登录";
    ViewBag.subTitle = "欢迎登录";
    Layout = "~/Views/Shared/_Layout_Author.cshtml";
}

@section styles
{
    <style>
        .inputWrap {
            float: left;
            width: 320px;
            height: 310px;
            background-color: white;
            border: 1px solid #dedede;
            line-height: 20px;
            margin-top: 120px;
        }

        .inputWrap > div:first-child {
            padding: 10px 0 10px 35px;
            color: #e31818;
            font-size: 16px;
            font-family: "宋体";
            font-weight: bold;
        }

        .inputWrap > p {
            padding: 30px 0 0 35px;
        }

        .username > input {
            margin: 0 0 0 10px;
            width: 203px;
            height: 30px;
        }

        #password {
            margin: 0 0 0 10px;
            width: 120px;
            height: 30px;
        }

        #passwordbtn {
            background-color: #dedede;
            border: none;
        }

        #AjaxSubmit {
            width: 240px;
            height: 30px;
            background-color: #e31818;
            border: none;
            color: white;
            margin: 60px 0 10px 50px;
        }

        .password input.yzm {
            padding: 0 5px 0 5px;
            font-size: 10px;
            height: 30px;
            margin-left: 10px;
            width: 70px;
        }

        .textr {
            text-align: right;
        }

        .pt60 {
            padding-top: 60px;
        }

        .fl {
            float: left;
            width: 660px;
            margin-left: -330px;
        }

        .fr {
            float: right;
            margin-left: -200px !important;
        }

        .w1024 {
            width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .yyzh {
            text-align: right;
            margin-right: 44px;
        }

        .yyzh > span {
            color: #dedede;
        }
    </style>
}
<div class="w1024">
    <form action="@Url.Action("Login")" method="post" id="AjaxForm">

        <div class="textr pt60 fl">

            <img src="/Content/images/img/login_rejister.png" />

        </div>
        <div class="fr">
            <div class="inputWrap">
                <div>手机登录</div><hr />
                <p class="username">
                    <span>手机号</span>
                    <input type="text" id="account" name="account" placeholder="请输入手机号码" />
                </p>
                <p class="password">
                    <span>验证码</span>
                    <input type="text" id="password" name="password" placeholder="请输入验证码" />
                    <input type="button" id="passwordbtn" class="yzm" value="获取验证码" />
                </p>
                <div>
                    <input type="button" id="AjaxSubmit" value="登录" />
                    <p class="yyzh">
                        <span>没有账号？</span><a href="@Url.Action("Register", new {area = "", Controller = "Author"})">快速注册</a>
                    </p>
                </div>
            </div>
        </div>

    </form>
</div>
@section scripts
{
    <script type="text/javascript">

        function AjaxSubmitValidate() {
            var account = $("#account");
            var password = $("#password");
            if (account.val() == "") {
                $("#loginbtn").attr('disabled', false);
                ShowError("account", "请输入手机号码");
                account.focus();
                return false;
            }
            if (password.val() == "") {
                $("#loginbtn").attr('disabled', false);
                ShowError("password", "请输入验证码");
                password.focus();
                return false;
            }
            return true;
        }


        var login_quick_query = {
            sms: function (num, callback) {
                var reg = /^[1][34578]\d{9}$/;
                var account = $("#account");
                if (account.val() == "") {
                    ShowError("account", "请输入手机号码");
                    account.focus();
                    sendSmsOpen = true;
                    return;
                }
                if (!reg.test(account.val())) {
                    ShowError("account", "手机号码有误");
                    account.focus();
                    sendSmsOpen = true;
                    return;
                }
                var url = '/Author/SmSVeriCode';
                $.post(url, { "phone": $("#account").val() }, function (data) {
                    return callback(data);
                });
            }
        }

        var sendSmsOpen = true;

        $(function () {
            $("#passwordbtn").click(function () {
                if (sendSmsOpen) {
                    sendSmsOpen = false;
                    login_quick_query.sms($("#account").val(), function (data) {
                        if (data.ErrCode != "0") {
                            ShowError("password", data.ErrMsg);
                            clearInterval(timer);
                            sendSmsOpen = true;
                            return;
                        }
                        else {
                            login_sendSmsFun(60, $('#passwordbtn'));
                        }
                    })
                }
            });
        });


        //倒计时
        function login_sendSmsFun(time, obj) {
            obj.attr('value', time + 's后重新发送');
            obj.addClass('disable');
            $("#AjaxSubmit").removeClass('disable');
            timer = setInterval(function () {
                time--;
                obj.attr('value', time + 's后重新发送');
                if (time == -1) {
                    clearInterval(timer);
                    sendSmsOpen = true;
                    obj.val('点击获取');
                    obj.removeClass('disable');
                    return;
                };
            }, 1000);
        }
    </script>
}