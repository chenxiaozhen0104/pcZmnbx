@using Repair.Web.Site.Areas.Sp.Models
@using Repair.Web.Site.Models
@using Newtonsoft.Json
@using LZY.BX.Model
@model List<RepairCountReportModel>
@{
    ViewBag.Title = "维修量统计";
    ViewBag.title1 = "统计";
    ViewBag.title2 = "维修量统计";

    var data = JsonConvert.SerializeObject(Model);

    var company = (User as UserCookie) == null ? new ServiceCompany() : (User as UserCookie).ServiceCompany;
}

@section styles{
    <style>
        .form-group {
            padding-right: 0;
        }

        .inputText {
            width: 96% !important;
        }

        .col-xs-3 {
            font-size: 14px;
            height: 34px;
            line-height: 34px;
            border-bottom: 1px solid #dcdcdc;
        }

        .active {
            border-bottom: 2px solid #41b0f8;
        }

        .charts {
            height: 500px;
            width: 920px;
        }
    </style>
}

<form action="RepairCount">
    <div class="clear-bottom-15 clear-top-15 panel-body row">
        <div class="col-xs-3 text-center active ">表格</div>
        <div class="col-xs-3 text-center">图表</div>
        <div class="form-group col-xs-5 pull-right">
            <div class="input-group  ">
                <div class="input-group-addon">年份</div>
                <input name="keywords" id="input_text" placeholder="请输入年份查询" class="form-control inputText" />
                <span class="input-group-btn ">
                    <button class="btn btn-default" type="submit">搜素</button>
                </span>
            </div>
        </div>
    </div>
    <ul class="formlists">
        <li>
            <table class="table table-bordered table-hover">
                <tr>
                    <th>年份</th>
                    <th>1月</th>
                    <th>2月</th>
                    <th>3月</th>
                    <th>4月</th>
                    <th>5月</th>
                    <th>6月</th>
                    <th>7月</th>
                    <th>8月</th>
                    <th>9月</th>
                    <th>10月</th>
                    <th>11月</th>
                    <th>12月</th>
                    <th>总数</th>
                </tr>

                <tr>    
                    <td>@ViewData["Year"]</td>               
                    @{
                        var count = 0;
                        for (int i = 1; i < 13; i++)
                        {
                          
                            var flag = false;
                            foreach (var item in Model)
                            {
                                if (i == item.Time)
                                {
                                    count += item.Count;
                                    <td>@item.Count</td>
                                    flag = true;
                                    break;
                                }
                            }
                            if (!flag)
                            {
                                <td>0</td>
                            }
                        }
                        <td>@count</td>
                    }
                </tr>
                @*@{
                    for (int i = 0; i < 9; i++)
                    {
                        <tr>
                            @for (int j = 0; j < 14; j++)
                            {
                                <td>-</td>
                            }
                        </tr>
                    }
                }*@
            </table>
        </li>
        <li style="display:none">
            <div class="charts"></div>
        </li>
    </ul>
</form>


@section scripts{
    <script src="~/Scripts/echarts.min.js"></script>
    <script>
        $(".col-xs-3").click(function () {
            $(this).addClass("active").siblings(".col-xs-3").removeClass("active");
            var index = $(this).index();
            $(".formlists>li").eq(index).show().siblings("li").hide();

        })

        var data = eval(@Html.Raw(data));
        var times = new Array();
        var counts = new Array();

        for (var j = 1; j < 13; j++) {
            var flag = false;
            $.each(data, function (i, item) {
                if (j == item.Time) {
                    counts.push(item.Count);
                    flag = true;
                }
            });

            if (!flag) {
                counts.push('0');
            }
        }

        var myChart = echarts.init($(".charts")[0]);
         var company=@company
        option = {

                 title: {
                     text: company ? company.Name:"" + '工单数量统计',
                subtext: @ViewData["Year"]+'年度',
                x: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'line'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                top: '20%',
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
                    //axisTick: {
                    //    alignWithLabel: true
                    //}
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '工单数量',
                    axisLabel: {
                        show: true,
                        formatter: '{value} 个',
                    }
                }
            ],
            series: [
                {
                    name: '工单数量',
                    type: 'line',
                    itemStyle: {
                        normal: {
                            label: { show: true }
                        }
                    },
                    data: counts
                }
            ]
        };
        myChart.setOption(option);


    </script>
}